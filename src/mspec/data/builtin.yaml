lingo:
    version: "builtin-beta-1"

modules:
    auth:
        name:
            lower_case: "auth"

        ops:

            create_user:
                name:
                    lower_case: "create user"
                description: "Create a new user with name and email"
                func:
                    call: "auth.create_user"
                    args:
                        name:
                            params: {name: {}}
                        email:
                            params: {email: {}}
                        password:
                            params: {password: {}}
                        password_confirm:
                            params: {password_confirm: {}}
                params:
                    name:
                        name:
                            lower_case: "name"
                        type: str
                        description: "Name of the user"
                    email:
                        name:
                            lower_case: "email"
                        type: str
                        description: "Email of the user"
                    password:
                        name:
                            lower_case: "password"
                        type: str
                        secure_input: true
                        description: "Password for the user"
                    password_confirm:
                        name:
                            lower_case: "password confirm"
                        type: str
                        secure_input: true
                        description: "Password confirmation"
                result:
                    type: struct
                    fields:
                        id:
                            name:
                                lower_case: "id"
                            type: str
                            description: "ID of the created user"
                        name:
                            name:
                                lower_case: "name"
                            type: str
                            description: "Name of the created user"
                        email:
                            name:
                                lower_case: "email"
                            type: str
                            description: "Email of the created user"

            login_user:
                name:
                    lower_case: "login user"
                description: "Login a user with email and password"
                python:
                    call: "auth.login_user"
                params:
                    email:
                        name:
                            lower_case: "email"
                        type: str
                        description: "Email of the user"
                    password:
                        name:
                            lower_case: "password"
                        type: str
                        description: "Password for the user"
                        secure_input: true
                output:
                    access_token:
                        name:
                            lower_case: "access token"
                        type: str
                        secure: true
                        description: "Access token for the logged in user"
                    token_type:
                        name:
                            lower_case: "token type"
                        type: str
                        description: "Type of the token"

            current_user:
                name:
                    lower_case: "current user"
                description: "Get the current logged in user"
                python:
                    call: "auth.current_user"
                params: {}
                output:
                    id:
                        name:
                            lower_case: "id"
                        type: str
                        description: "ID of the current user"
                    name:
                        name:
                            lower_case: "name"
                        type: str
                        description: "Name of the current user"
                    email:
                        name:
                            lower_case: "email"
                        type: str
                        description: "Email of the current user"
                    number_of_sessions:
                        name:
                            lower_case: "number of sessions"
                        type: int
                        description: "Number of active sessions for the current user"

            logout_user:
                name:
                    lower_case: "logout user"
                description: "Logout the current user"
                python:
                    call: "auth.logout_user"
                params:
                    mode:
                        name:
                            lower_case: "mode"
                        type: str
                        enum:
                            - "all"
                            - "current"
                            - "others"
                        description: "Logout mode, use all to logout from all sessions, current to logout from current session, others to logout all sessions except this one"
                output:
                    acknowledged:
                        name:
                            lower_case: "acknowledged"
                        type: bool
                        description: "Whether the logout was successful"
                    message:
                        name:
                            lower_case: "message"
                        type: str
                        description: "Acknowledgement message"

            delete_user:
                name:
                    lower_case: "delete user"
                description: "Delete currently logged in user"
                python:
                    call: "auth.delete_user"
                params: {}
                output:
                    acknowledged:
                        name:
                            lower_case: "acknowledged"
                        type: bool
                        description: "Whether the deletion was successful"
                    message:
                        name:
                            lower_case: "message"
                        type: str
                        description: "Acknowledgement message"

            drop_sessions:
                name:
                    lower_case: "drop sessions"
                description: "Drop all sessions"
                python:
                    call: "auth.drop_sessions"
                params:
                    root_password:
                        name:
                            lower_case: "root password"
                        type: str
                        secure_input: true
                        description: "Root password to authorize dropping all sessions"
                output:
                    acknowledged:
                        name:
                            lower_case: "acknowledged"
                        type: bool
                        description: "Always true, indicates the operation was successful"
                    message:
                        name:
                            lower_case: "message"
                        type: str
                        description: "Acknowledgement message"

        models:

            user:
                hidden: true
                name:
                    lower_case: "user"

                fields:
                    name:
                        name:
                            lower_case: "name"
                        type: str
                        examples:
                            - "alice"
                            - "bob"

                    email:
                        name:
                            lower_case: "email"
                        type: str
                        examples:
                            - "alice@example.com"
                            - "bob@example.com"

            user_session:
                hidden: true
                name:
                    lower_case: "user session"

                fields:
                    user_id:
                        name:
                            lower_case: "user id"
                        type: foreign_key
                        references:
                            table: "user"
                            field: "id"
                        examples:
                            - "1"
                            - "2"

                    session_token:
                        name:
                            lower_case: "session token"
                        type: str
                        examples:
                            - "token_abc123"
                            - "token_def456"

                    created_at:
                        name:
                            lower_case: "created at"
                        type: datetime
                        examples:
                            - "2023-01-01T12:00:00Z"
                            - "2023-01-02T15:30:00Z"

            password_hash:
                hidden: true
                name:
                    lower_case: "password hash"

                fields:
                    hash:
                        name:
                            lower_case: "hash"
                        type: str
                        examples:
                            - "hashed_password_1"
                            - "hashed_password_2"

                    user_id:
                        name:
                            lower_case: "user id"
                        type: foreign_key
                        references:
                            table: "user"
                            field: "id"
                        examples:
                            - "1"
                            - "2"
