<!DOCTYPE html>
<html>

    <head>
        <title>mspec.msample.sample_item.id</title>
        <link rel="stylesheet" type="text/css" href="/style.css">
        <script src="/msample/sample_item/index.js"></script>
        <script type="text/javascript">

            //
            // views
            //

            function showSampleItemReadView() {
                window.document.getElementById('sample-item-update').hidden = true;
                window.document.getElementById('sample-item-delete').hidden = true;
                window.document.getElementById('sample-item-read').hidden = false;
            }

            function showSampleItemUpdateView() {
                window.document.getElementById('sample-item-read').hidden = true;
                window.document.getElementById('sample-item-delete').hidden = true;
                window.document.getElementById('sample-item-update').hidden = false;
            }

            function showSampleItemDeleteView() {
                window.document.getElementById('sample-item-read').hidden = true;
                window.document.getElementById('sample-item-update').hidden = true;
                window.document.getElementById('sample-item-delete').hidden = false;
            }

            //
            // server ops
            //

            function fetchSampleItem() {
                const id = sampleItemId();
                console.log(`fetching sampleItem ${id}`);
                readSampleItem(id)
                    .then(response => response.json())
                    .then(data => {
                        console.log(data);

                        document.getElementById('sample-item-id').innerText = id;

                        const readTBody = document.querySelector('#sample-item-read-tbody');
                        sampleItemToDisplayTBody(data, readTBody);

                        const updateTBody = document.querySelector('#sample-item-update-tbody');
                        sampleItemToInputTBody(data, updateTBody);
                    })
                    .catch(error => {console.error(error)});
            }

            function deleteSampleItem() {
                const id = sampleItemId();
                console.log(`deleting sampleItem ${id}`);
                deleteSampleItem(id)
                .then(response => {console.log(`sampleItem ${id} deleted`)})
                .catch(error => {console.error(error)});
            }

            function updateSampleItem() {

                const id = sampleItemId();
                
                const updateTBody = document.querySelector('#sample-item-update-tbody');
                const data = sampleItemFromInputTBody(updateTBody);

                const verify = verifySampleItem(data);
                if (verify.valid !== true) {
                    console.error(verify);
                    throw new Error(`sampleItem ${id} invalid`);
                }

                console.log(`updating sampleItem ${id}`);

                updateSampleItem(id, data)
                    .then(response => {console.log(`sampleItem ${id} updated`)})
                    .catch(error => {console.error(error)});

            }

            //
            // on load
            //

            function sampleItemId() {
                return window.location.pathname.split('/').pop();
            }

            window.onload = () => {
                fetchSampleItem();
            }

        </script>
    </head>

    <body>
        <h1>sample_item</h1>
        <p>the sample_item protocol browser</p>

        <!-- 
        read view layout 
        -->

        <div id="sample-item-read">
            
            <button onclick="fetchSampleItem()">load</button>
            &emsp;|&emsp;
            <button onclick="showSampleItemUpdateView()">update</button>
            &emsp;|&emsp;
            <button onclick="showSampleItemDeleteView()">delete</button>

            <p>id: <span id="sample-item-id"></span></p>

            <table>
                <thead>
                    <tr>
                        <th>field</th>
                        <th>value</th>
                    </tr>
                </thead>
                <tbody id="sample-item-read-tbody">
                </tbody>
            </table>

        </div>

        <!-- 
        update view layout 
        -->

        <div id="sample-item-update" hidden>

            <button onclick="updateSampleItem()">save</button>
            &emsp;|&emsp;
            <button onclick="showSampleItemReadView()">cancel</button>

            <table>
                <thead>
                    <tr>
                        <th>field</th>
                        <th>value</th>
                    </tr>
                </thead>
                <tbody id="sample-item-update-tbody">
                </tbody>
            </table>

        </div>

        <!-- 
        delete view layout 
        -->

        <div id="sample-item-delete" hidden>

            <p>confirm delete?</p>
            <button onclick="deleteSampleItem()">yes, please delete</button>
            &emsp;|&emsp;
            <button onclick="showSampleItemReadView()">no, cancel</button>

        </div>

    </body>

</html>