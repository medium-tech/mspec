<!DOCTYPE html>
<html>

    <head>
        <title>mspec.msample.sample_item</title>
        <link rel="stylesheet" type="text/css" href="/style.css">
        <script src="/msample/sample_item/index.js"></script>

        <script type="text/javascript">

            //
            // views
            //

            function showSampleItemListView() {
                document.getElementById('sample-item-create').hidden = true;
                document.getElementById('sample-item-list').hidden = false;
            }

            function showSampleItemCreateView() {
                document.getElementById('sample-item-list').hidden = true;
                document.getElementById('sample-item-create').hidden = false;
            }

            function showEmptyRow() {
                document.getElementById('sample-item-list-empty-row').hidden = false
            }

            function hideEmptyRow() {
                document.getElementById('sample-item-list-empty-row').hidden = true
            }

            //
            // server ops
            //

            function loadItems() {

                const offset = parseInt(document.getElementById('sample-item-list-offset').innerText)
                const size = parseInt(document.getElementById('sample-item-list-size').innerText)

                console.log(`loadItems(offset=${offset}, size=${size})`)

                listSampleItems(offset, size)
                    .then(items => {
                        console.log(items)
                    })
                    .catch(error => {
                        console.error(error)
                    });
            }

            function changePage(direction) {

                let offset = parseInt(document.getElementById('sample-item-list-offset').innerText)
                let size = parseInt(document.getElementById('sample-item-list-size').innerText)

                if (direction < 0) {
                    offset -= size
                    if (offset < 0) offset = 0
                } else if (direction == 0) {
                    offset = 0
                } else {
                    offset += size
                }

                document.getElementById('sample-item-list-offset').innerText = offset
                
                // 

                const url = new URL(window.location.href)
                url.searchParams.set('offset', offset)
                url.searchParams.set('size', size)
                window.history.pushState({}, '', url)
                
                //

                loadItems()
            }

            //
            // on load
            //

            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('offset')) document.getElementById('sample-item-list-offset').innerText = urlParams['offset']
            if (urlParams.has('size')) document.getElementById('sample-item-list-size').innerText = urlParams['size'];

            const defaultSampleItem = {
                name: '',
                verified: false,
                color: 'red',
                age: 42,
                score: 5.0,
                tags: []
            }

            window.onload = function() {
                loadItems();
                
                // fill form with default values
                const createTBody = document.querySelector('#sample-item-create-tbody');
                sampleItemToDisplayTBody(defaultSampleItem, createTBody)
            }

        </script>
    </head>

    <body>
        <h1>sample_item</h1>
        <p>the sample_item protocol browser</p>

        <!-- 
        list view layout 
        -->

        <div id="sample-item-list">
            
            <button onclick="changePage(-1)">prev</button>
            &emsp;|&emsp;
            <button onclick="loadItems()">load</button>
            &emsp;|&emsp;
            <button onclick="changePage(1)">next</button>
            &emsp;|&emsp;
            <button onclick="showSampleItemCreateView()">create</button>

            <br>
            
            offset: <span id="sample-item-list-offset">0</span>
            &emsp;|&emsp;
            size: <span id="sample-item-list-size">25</span>
            
            <br>

            <table>
                <thead>
                    <tr>
                        <th>id</th>
                        <th>name</th>
                        <th>verified</th>
                        <th>color</th>
                        <th>age</th>
                        <th>score</th>
                        <th>tags</th>
                    </tr>
                </thead>

                <tbody id="sample-item-list-tbody">
                    <tr id="sample-item-list-empty-row"><td colspan="7">no items</td></tr>
                </tbody>
            </table>

        </div>

        <!-- 
        create view layout 
        -->

        <div id="sample-item-create" hidden>

            <button onclick="createSampleItem()">create</button>
            &emsp;|&emsp;
            <button onclick="showSampleItemListView()">cancel</button>

            <table>
                <thead>
                    <tr>
                        <th>field</th>
                        <th>value</th>
                    </tr>
                </thead>
                <tbody id="sample-item-create-tbody">
                </tbody>
            </table>

        </div>

    </body>

</html>